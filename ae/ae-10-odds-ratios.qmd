---
title: "AE 10: Odds ratios"
---

::: callout-important
Go to the [course GitHub organization](https://github.com/sta210-s22) and locate the repo titled `ae-10-odds-ratios-YOUR_GITHUB_USERNAME` to get started.
:::

## Packages

```{r}
#| label: load-pkgs-data
#| message: false
 
library(tidyverse)
library(tidymodels)
library(palmerpenguins)
library(knitr)
```

## Data: Palmer penguins

In this application exercise we'll work with the `penguins` data set from the [**palmerpenguins**](https://allisonhorst.github.io/palmerpenguins/) package.
This data set contains measurements and other characteristics for over 300 penguins observed near Palmer Station in Antarctica.

We will use the following variables:

| variable          | class   | description                                      |
|:-------------------------|:------------------|:---------------------------|
| species           | integer | Penguin species (Adelie, Gentoo, Chinstrap)      |
| island            | integer | Island where recorded (Biscoe, Dream, Torgersen) |
| flipper_length_mm | integer | Flipper length in mm                             |

The goal of this analysis is to use logistic regression to understand the relationship between flipper length, island, and whether a penguin is from the Adelie species.

## Response variable

We need to create a new response variable to identify whether a penguin is from the Adelie species.

```{r}
penguins <- penguins %>%
  mutate(adelie = factor(if_else(species == "Adelie", 1, 0)))
```

```{r}
# check variable
penguins %>%
  count(adelie, species)
```

```{r}
#| out.width: "70%"

# visualize response
ggplot(data = penguins, aes(x = adelie)) + 
  geom_bar() + 
  labs(title = "Distribution of penguin species") + 
  scale_x_discrete(labels = c("1" = "Adelie", "0" = "Chinstrap/Gentoo"))
```

## Part 1: Odds Ratios

Let's start by looking at the relationship between island and whether a penguin is from the Adelie species.

1.  What does the `values_fill` argument do in the following chunk?

```{r}
penguins %>%
  count(island, adelie) %>%
  pivot_wider(names_from = adelie, values_from = n, values_fill = 0)
```

2.  Calculate the odds ratio of a penguin being from the Adelie species for those recorded on Dream compared to those recorded on Biscoe.

3.  You want to fit a model using `island` to predict the odds of being from the Adelie species.
    Let $\pi$ be the probability a penguin is from the Adelie species.
    The model has the following form.
    What do you expect the value of $\hat{\beta}_1$, the estimated coefficient for *Dream*, to be?

$$
\log\Big(\frac{\pi}{1-\pi}\Big) = \beta_0 + \beta_1 ~ Dream + \beta_2 ~ Torgersen
$$

4.  Fill in the code below to fit the model. Once you do, remove the chunk option `eval: false` so that the chunk actually gets evaluated.

```{r}
#| eval: false

adelie_island <- ___ %>%
  set_engine("___") %>%
  fit(___ ~ ___, data = penguins, family = "binomial")

tidy(adelie_island)
```

5.  Based on this model, what are the **odds** of a penguin being from the Adelie species if it was recorded on Biscoe island? on Dream island?

## Part 2: Add flipper length

Let's add flipper length to the model.

```{r}
adelie_island_flipper <- logistic_reg() %>%
  set_engine("glm") %>%
  fit(adelie ~ island + flipper_length_mm, data = penguins, family = "binomial")

tidy(adelie_island_flipper)
```

6.  Write the regression equation.

$$\log\Big(\frac{\hat{\pi}}{1 - \hat{\pi}}\Big) = ???$$

7.  Interpret the coefficient of `flipper_length_mm` in terms of the log-odds of being from the Adelie species.

8.  Interpret the coefficient of `flipper_length_mm` in terms of the odds of being from the Adelie species.

9.  Interpret the coefficient of `Dream` in terms of the odds of being from the Adelie species.

## Part 3: Change in odds

10. How do you expect the log-odds of being from the Adelie species to change when going from a penguin with flipper length 185 mm to a penguin with flipper length 200 mm?
    Assume both penguins were recorded on the Dream island.

11. How do you expect the odds of being from the Adelie species to change when going from a penguin with flipper length 185 mm to a penguin with flipper length 200 mm?
    Assume both penguins were recorded on the Dream island.
