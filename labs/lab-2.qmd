---
title: "Lab 2 - College scorecard"
editor: visual
reference-location: margin
---

## Introduction

In today's lab, you'll use simple linear regression to analyze the relationship between the admissions rate and total cost for colleges and universities in the United States.

### Learning goals

By the end of the lab you will...

-   Be able to fit a simple linear regression model using R.
-   Be able to interpret the slope and intercept for the model.
-   Be able to use statistical inference to draw conclusions about the slope.
-   Continue developing a workflow for reproducible data analysis.

## Getting started

-   Go to the [sta210-s22](https://www.github.com/sta210-s22) organization on GitHub.
    Click on the repo with the prefix **lab-2**.
    It contains the starter documents you need to complete the lab.

-   Clone the repo and start a new project in RStudio.
    See the [Lab 1 instructions](labs/lab-1.html) for details on cloning a repo, starting a new R project and configuring git.

## Packages

We will use the following package in today's lab.

```{r}
#| message: false

library(tidyverse)  # for data wrangling + visualization
library(tidymodels) # for modeling
library(knitr)      # for pretty printing of tables
```

## Data: College scorecard

The data for this lab is from the `scorecard` data set in the **rcfss** R package.
It includes information originally obtained from the [U.S. Department of Education's College Scorecard](https://collegescorecard.ed.gov/data/) for 1753 colleges and universities during the 2018 - 2019 academic year.

The lab focuses on the following variables:

-   `admrate`: Undergraduate admissions rate (from 0-100%)

-   `cost`: The average annual total cost of attendance, including tuition and fees, books and supplies, and living expenses

-   `type`: Type of college (Public; Private, nonprofit; Private, for-profit)

[Click here](https://uc-cfss.github.io/rcfss/reference/scorecard.html) to see a full list of variables and definitions.

Use the code below to load the data set.

```{r}
#| message: false

scorecard <- read_csv("data/scorecard.csv")
```

## Exercises

::: callout-note
Include axis labels and an informative title for all plots.
Use the `kable()` function to neatly print tables and regression output.
:::

### Exercise 1

Create a histogram to examine the distribution of `admrate` and calculate summary statistics for the center (mean and median) and the spread (standard deviation and IQR).

### Exercise 2

Use the results from the previous exercise to describe the distribution of `admrate`.
Include the shape, center, spread, and if there are potential outliers.

### Exercise 3

Plot the distribution of `cost` and calculate the appropriate summary statistics.
Describe the distribution of `cost` (shape, center, and spread, and outliers) using the plot and appropriate summary statistics.

### Exercise 4

The goal of this analysis is to fit a regression model that can be used to understand the variability in the cost of college based on the admission rate.
Before fitting the model, let's look at the relationship between the two variables.
Create a scatterplot to display the relationship between cost and admissions rate.
Describe the relationship between the two variables based on the plot.

### Exercise 5

Does the relationship between cost and admissions rate differ by type of college?
Modify the plot from the previous exercise visualize the relationship by type of college.

### Exercise 6

Describe two new observations from the scatterplot in Exercise 5 that you didn't see in the scatterplot from Exercise 4.

### Exercise 7

Fit the linear regression model.
Display the confidence interval for the coefficients in the output.
Use the `kable` function to neatly display the results.

### Exercise 8

Consider the model from the previous exercise.

-   Interpret the slope in the context of the problem.
-   Does the intercept have a meaningful interpretation? If so, write the interpretation in the context of the problem. Otherwise, explain why the interpretation is not meaningful.

### Exercise 9

Does the data provide evidence of a statistically significant linear relationship between cost and admissions rate?
Conduct a hypothesis test to answer this question.
In your response

-   State the null and alternative hypotheses used to answer this question in words and in mathematical notation.
-   What is the test statistic? State with the test statistic means in context.
-   What distribution was used to calculate the p-value?
-   State your conclusion for the test in context.

### Exercise 10

Interpret the 95% confidence interval for the slope in context.
Then indicate whether or not it is consistent with the results of the hypothesis test from the previous exercise.
Briefly explain your response.

## Submission

::: callout-warning
Before you wrap up the assignment, make sure all documents are updated on your GitHub repo.
We will be checking these to make sure you have been practicing how to commit and push changes.

Remember -- you must turn in a PDF file to the Gradescope page before the submission deadline for full credit.
:::

To submit your assignment:

-   Go to [http://www.gradescope.com](http://www.gradescope.com/) and click *Log in* in the top right corner.
-   Click *School Credentials* ➡️ *Duke NetID* and log in using your NetID credentials.
-   Click on your *STA 210* course.
-   Click on the assignment, and you'll be prompted to submit it.
-   Mark the pages associated with each exercise. All of the pages of your lab should be associated with at least one question (i.e., should be "checked").
-   Select the first page of your PDF submission to be associated with the *"Workflow & formatting"* section.

## Grading

Total points available: 50 points.

| Component             | Points |
|-----------------------|--------|
| Ex 1 - 10             | 45     |
| Workflow & formatting | 5[^1]  |

[^1]: The "Workflow & formatting" grade is to assess the reproducible workflow.
    This includes having at least 3 informative commit messages and updating the name and date in the YAML.

```{r}
knitr::knit_exit()
```

## Quantify the variability of the slope {.smaller}

\*\*for testing\*\*

\- Two approaches:

1.  Via simulation (what we'll do today)

2.  Via mathematical models (what we'll do in the next class)

\- Randomizing to quantify the variability of the slope for the purpose of testing, under the assumption that the null hypothesis is true:

-   Simulate new samples from the original sample via permutation

-   Fit models to each of the samples and estimate the slope

-   Use features of the distribution of the permuted slopes to conduct a hypothesis test

## Permutation, described {.smaller}

::: columns
::: {.column width="40%"}
\- Set the null hypothesis to be true, and measure the natural variability in the data due to sampling but \*\*not\*\* due to variables being correlated by permuting permute one variable to eliminate any existing relationship between the variables

\- Each \`price\` value is randomly assigned to \`area\` of a given house, i.e. \`area\` and \`price\` are no longer matched for a given house
:::

::: {.column width="60%"}
\`\`\`{r}

set.seed(1234)

duke_forest_rand \<- duke_forest %>%

mutate(

price_Observed = price,

price_Permuted = sample(price, size = nrow(duke_forest))

) %>%

select(contains("price\_"), area)

duke_forest_rand

\`\`\`
:::
:::

## Permutation, visualized

::: columns
::: {.column width="50%"}
\- Each of the observed values for \`area\` (and for \`price\`) exist in both the observed data plot as well as the permuted \`price\` plot

\- The permutation removes the linear relationship between \`area\` and \`price\`
:::

::: {.column width="50%"}
\`\`\`{r}

#\| out.width: "100%"

#\| fig.asp: 1.2

duke_forest_rand %>%

pivot_longer(cols = contains("price\_"), names_to = "price_type", names_prefix = "price\_", values_to = "price") %>%

ggplot(aes(x = area, y = price)) +

geom_point() +

geom_smooth(aes(color = price_type), method = "lm", se = FALSE, show.legend = FALSE) +

facet_wrap(\~price_type, nrow = 2) +

scale_color_manual(values = c("#8F2D56", "gray")) +

scale_x\_continuous(labels = label_number()) +

scale_y\_continuous(labels = label_dollar()) +

labs(x = "Area", y = "Price")

\`\`\`
:::
:::

## Permuation, repeated

Repeated permutations allow for quantifying the variability in the slope under the condition that there is no linear relationship (i.e., that the null hypothesis is true)

\`\`\`{r}

set.seed(1120)

df_perm_samples_100 \<- duke_forest %>%

specify(price \~ area) %>%

hypothesize(null = "independence") %>%

generate(reps = 100, type = "permute")

p_df_boot_samples_100 \<- ggplot(df_perm_samples_100, aes(x = area, y = price, group = replicate)) +

geom_line(stat = "smooth", method = "lm", se = FALSE, alpha = 0.1) +

labs(

x = "Area (square feet)",

y = "Sale price (USD)",

title = glue("Permuted samples 1 - 100")

) +

scale_y\_continuous(labels = label_dollar()) +

scale_x\_continuous(labels = label_number())

p_df_boot_samples_100 +

geom_abline(intercept = intercept, slope = slope, color = "#8F2D56")

\`\`\`

## Concluding the hypothesis test {.smaller}

::: question
Is the observed slope of \$\\hat{\\beta_1} = 159\$ (or an even more extreme slope) a likely outcome under the null hypothesis that \$\\beta = 0\$?

What does this mean for our original question: "Do the data provide sufficient evidence that \$\\beta_1\$ (the true slope for the population) is different from 0?"
:::

\`\`\`{r}

#\| out.width: "60%"

#\| fig.asp: 0.618

perm_fits \<- df_perm_samples_100 %>%

fit()

ggplot(perm_fits %>% filter(term == "area"),

aes(x = estimate)) +

geom_histogram(binwidth = 10, color = "white") +

geom_vline(xintercept = slope, color = "#8F2D56", size = 1) +

labs(x = "Slope", y = "Count",

title = "Slopes of 1,000 permuted samples") +

scale_x\_continuous(limits = c(-160, 160), labels = label_dollar())

\`\`\`
